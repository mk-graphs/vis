<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Black Hole Gravitational Lensing Visualization</title>
  <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
  <style>
    html, body {
      margin: 0; padding: 0;
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f9f9f9;
    }
    .jxgbox {
      margin: 20px auto 40px auto;
      border: 1px solid #ccc;
      width: 700px;
      height: 600px;
      background: white;
    }
    .theory {
      max-width: 700px;
      margin: 20px auto;
      text-align: left;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
      font-size: 16px;
      line-height: 1.5;
      white-space: pre-wrap;
      font-family: Consolas, monospace;
    }
  </style>
</head>
<body>

<h1>Black Hole Gravitational Lensing</h1>

<div class="theory">
  Theory and Explanation:
  ----------------------------------------
  Gravitational lensing occurs when light rays bend around a massive object like a black hole.<br><br>
  The bending angle α can be approximated by:<br>
  α = (4GM) / (c² b)<br><br>
  where:<br>
  - G: gravitational constant<br>
  - M: mass of black hole<br>
  - c: speed of light<br>
  - b: impact parameter (closest distance of the light ray to black hole)<br><br>
  In this visualization, the black hole is at the origin.<br>
  Multiple light rays start from the left with different offsets.<br>
  Rays bend near the black hole with bending angle inversely proportional to b.<br><br>
  Use the slider to adjust the mass M and see how the bending changes.
</div>

<div id="box" class="jxgbox"></div>

<script type="text/javascript">
  const board = JXG.JSXGraph.initBoard('box', {
    boundingbox: [-6, 6, 6, -6],
    axis: true,
    grid: false,
    showNavigation: false,
    showCopyright: false
  });

  // Constants (normalized units)
  const c = 1;      // speed of light (normalized)
  let G = 1;        // gravitational constant (normalized)
  let M = 1;        // black hole mass (variable by slider)

  // Draw black hole as filled black circle at origin
  board.create('circle', [[0, 0], 0.3], {
    fillColor: 'black',
    fillOpacity: 1,
    strokeColor: 'black',
    strokeWidth: 1,
    fixed: true
  });

  // Mass slider to change black hole mass M
  const massSlider = board.create('slider', [[-5, 5.5], [5, 5.5], [0.1, 1, 3]], {
    name: 'Mass M',
    snapWidth: 0.01,
    precision: 2
  });

  // Text showing current mass M
  const massText = board.create('text', [-5, 5.8, function() {
    return `Black Hole Mass M = ${massSlider.Value().toFixed(2)}`;
  }], { fontSize: 16 });

  // Function: bending angle α = 4GM / (c² b)
  // Here c=1, G=1 (normalized), so α = 4 * M / b

  // Number of rays
  const raysCount = 7;

  // Impact parameters (y offsets) spaced between -3 and 3, excluding very close to zero to avoid singularity
  let impactParameters = [];
  for(let i = 0; i < raysCount; i++) {
    // avoid zero: distribute from -3 to 3, skipping near zero
    let y = -3 + i * (6/(raysCount-1));
    if (Math.abs(y) < 0.3) y = (y > 0) ? 0.3 : -0.3;
    impactParameters.push(y);
  }

  // Clear old rays if exist
  let rays = [];

  function drawRays() {
    // Remove old rays
    rays.forEach(ray => board.removeObject(ray));
    rays = [];

    M = massSlider.Value();

    // For each ray, calculate bending and plot piecewise curve
    impactParameters.forEach(y0 => {
      // Bending angle alpha
      const alpha = 4 * M / Math.abs(y0);

      // Maximum x before bending region (start bending at x=0)
      const xStart = -5;

      // Ray before bending: straight line y = y0
      const beforeBend = board.create('line', [[xStart, y0], [0, y0]], {
        strokeWidth: 1,
        strokeColor: 'blue',
        straightFirst: false,
        straightLast: false
      });

      // Ray after bending: deflect by angle alpha around origin
      // Approximate as a straight line starting at (0, y0), rotated by alpha

      // Calculate direction vector after bending
      // Initial direction vector: (1,0)
      // After bending: rotated by sign of y0 * alpha (to keep bending direction correct)
      const sign = (y0 > 0) ? -1 : 1; // bending toward origin
      const bendAngle = sign * alpha;

      // Calculate endpoint for ray after bending
      const lengthAfter = 6; // arbitrary length after bending

      const xEnd = lengthAfter * Math.cos(bendAngle);
      const yEnd = y0 + lengthAfter * Math.sin(bendAngle);

      const afterBend = board.create('line', [[0, y0], [xEnd, yEnd]], {
        strokeWidth: 1,
        strokeColor: 'blue',
        straightFirst: false,
        straightLast: false
      });

      rays.push(beforeBend, afterBend);
    });
  }

  // Initial draw
  drawRays();

  // Update rays on slider change
  massSlider.on('drag', drawRays);
  massSlider.on('up', drawRays);

</script>

</body>
</html>
