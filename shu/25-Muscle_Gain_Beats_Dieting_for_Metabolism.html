<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Personalized Metabolism & Muscle Impact</title>
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <style>
        #jxgbox {
            width: 800px;
            height: 500px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 900px;
            margin: auto;
            background-color: #f9f9f9;
        }
        .input-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        .input-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .input-group input[type="number"], .input-group select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fefefe;
        }
        .input-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 5px;
        }
        .input-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #007BFF;
            cursor: pointer;
            border-radius: 50%;
        }
        #interactive-info {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            min-height: 25px;
        }
        .highlight {
            color: #28a745;
        }
        .note {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        .formula {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
          
            margin-top: 5px;
        }
    </style>
</head>
<body>

<h2>Personalized Metabolism and Muscle Impact</h2>
<p>
    Enter your details below and use the sliders to calculate your <strong>Basal Metabolic Rate (BMR)</strong> and <strong>Total Daily Energy Expenditure (TDEE)</strong> in real-time. Then, drag the green point on the graph to see how muscle mass change affects your BMR.
</p>

<div class="input-form">
    <div class="input-group">
        <label for="age">Age (years): <span id="age-val">30</span></label>
        <input type="range" id="age" value="30" min="15" max="100" />
    </div>
    <div class="input-group">
        <label for="gender">Gender</label>
        <select id="gender">
            <option value="male">Male</option>
            <option value="female">Female</option>
        </select>
    </div>
    <div class="input-group">
        <label for="weight">Weight (kg): <span id="weight-val">70</span></label>
        <input type="range" id="weight" value="70" min="40" max="200" />
    </div>
    <div class="input-group">
        <label for="height">Height (cm): <span id="height-val">175</span></label>
        <input type="range" id="height" value="175" min="100" max="250" />
    </div>
    <div class="input-group">
        <label for="activity">Activity Level</label>
        <select id="activity">
            <option value="1.2">Sedentary (little to no exercise)</option>
            <option value="1.375">Lightly Active (exercise 1-3 days/week)</option>
            <option value="1.55" selected>Moderately Active (exercise 3-5 days/week)</option>
            <option value="1.725">Very Active (exercise 6-7 days/week)</option>
            <option value="1.9">Extra Active (twice per day exercise)</option>
        </select>
    </div>
</div>

<div id="interactive-info"></div>
<div id="jxgbox"></div>

<h3>Key Concepts</h3>
<ul>
    <li>
        <strong>Basal Metabolic Rate (BMR):</strong> The minimum number of calories your body needs to function at rest.
        <div class="formula">
            <strong>Men:</strong> BMR = (10 × weight in kg) + (6.25 × height in cm) - (5 × age in years) + 5
            <br>
            <strong>Women:</strong> BMR = (10 × weight in kg) + (6.25 × height in cm) - (5 × age in years) - 161
        </div>
    </li>
    <li>
        <strong>Total Daily Energy Expenditure (TDEE):</strong> Your BMR plus the calories you burn from physical activity. This is a more accurate estimate of your daily calorie needs.
        <div class="formula">
            TDEE = BMR × Activity Level Multiplier
        </div>
    </li>
    <li><strong>Why Muscle Matters:</strong> One kg of muscle burns roughly <strong>30 kcal/day</strong> more at rest than one kg of fat. Therefore, a higher muscle mass directly increases your BMR and TDEE.</li>
    <li>
        <strong>The Graph:</strong> <ul>
            <li><strong>Red Dot:</strong> Your calculated <strong>BMR</strong> based on your inputs.</li>
            <li><strong>Blue Dot:</strong> Your estimated <strong>TDEE</strong>.</li>
            <li><strong>Green Dot:</strong> This is <strong>draggable</strong>. Move it along the X-axis to simulate muscle change and see the real-time impact on your BMR and TDEE.</li>
        </ul>
    </li>
</ul>

<script>
    let board;
    const initialValues = {
        age: 30,
        weight: 70,
        height: 175
    };

    // Mifflin-St Jeor Equation for BMR calculation
    function calculateBMR(age, gender, weight, height) {
        if (gender === 'male') {
            return (10 * weight) + (6.25 * height) - (5 * age) + 5;
        } else {
            return (10 * weight) + (6.25 * height) - (5 * age) - 161;
        }
    }

    // Function to calculate TDEE
    function calculateTDEE(bmr, activityMultiplier) {
        return bmr * activityMultiplier;
    }

    // Function to draw or update the graph
    function updateGraph() {
        const age = parseFloat(document.getElementById('age').value);
        const gender = document.getElementById('gender').value;
        const weight = parseFloat(document.getElementById('weight').value);
        const height = parseFloat(document.getElementById('height').value);
        const activityMultiplier = parseFloat(document.getElementById('activity').value);

        // Update slider value displays
        document.getElementById('age-val').innerText = age;
        document.getElementById('weight-val').innerText = weight;
        document.getElementById('height-val').innerText = height;

        const initialBMR = calculateBMR(age, gender, weight, height);
        const initialTDEE = calculateTDEE(initialBMR, activityMultiplier);

        // Destroy the old board if it exists
        if (board) {
            JXG.JSXGraph.freeBoard(board);
        }
        
        // Use a fixed bounding box with a negative ymin to ensure the X-axis is visible
        const fixedBoundingBox = [-6, 3500, 12, -200];
        
        board = JXG.JSXGraph.initBoard('jxgbox', {
            boundingbox: fixedBoundingBox,
            axis: true,
            grid: true,
            showNavigation: false
        });

        // Add axis labels
        board.create('text', [3, fixedBoundingBox[3] + 50, 'Muscle Change (kg)'], { fixed: true, fontSize: 14, cssStyle: 'font-weight: bold;' });
        board.create('text', [fixedBoundingBox[0] + 0.5, 1400, 'Calories (kcal/day)'], { fixed: true, fontSize: 14, rotation: -90, cssStyle: 'font-weight: bold;' });

        // Add a draggable point for muscle change
        const muscleChangePoint = board.create('point', [0, initialBMR], {
            name: 'Muscle Change',
            color: 'green',
            size: 6,
            label: { visible: false }
        });
        
        // Update information on drag
        muscleChangePoint.on('drag', function() {
            const muscleChange = this.X();
            const newBMR = initialBMR + (muscleChange * 30);
            const newTDEE = calculateTDEE(newBMR, activityMultiplier);

            // Restrict point movement to X-axis
            this.setCoords(muscleChange, newBMR);
            
            // Update the display text
            document.getElementById('interactive-info').innerHTML = `
                Muscle Change: <span class="highlight">${muscleChange.toFixed(1)} kg</span> | 
                Current BMR: <span class="highlight">${Math.round(newBMR)} kcal</span> | 
                Current TDEE: <span class="highlight">${Math.round(newTDEE)} kcal</span>
            `;
        });

        // Initialize display text
        document.getElementById('interactive-info').innerHTML = `
            Current BMR: <span class="highlight">${Math.round(initialBMR)} kcal</span> | 
            Current TDEE: <span class="highlight">${Math.round(initialTDEE)} kcal</span>
        `;
        
        // Create BMR and TDEE lines
        const bmrLine = board.create('functiongraph', [function(x) { return initialBMR + (x * 30); }, -5, 10], {
            strokeColor: 'red',
            strokeWidth: 3,
            name: 'BMR',
            withLabel: true,
            label: { position: 'right', offset: [5, 0], color: 'red' }
        });
        const tdeeLine = board.create('functiongraph', [function(x) { return calculateTDEE(initialBMR + (x * 30), activityMultiplier); }, -5, 10], {
            strokeColor: 'blue',
            strokeWidth: 3,
            dash: 2,
            name: 'TDEE',
            withLabel: true,
            label: { position: 'right', offset: [5, 0], color: 'blue' }
        });

        // Initial BMR and TDEE points
        board.create('point', [0, initialBMR], { name: 'Your BMR', color: 'red', size: 5, fixed: true, label: { offset: [5, 5] } });
        board.create('point', [0, initialTDEE], { name: 'Your TDEE', color: 'blue', size: 5, fixed: true, label: { offset: [5, 5] } });
    }

    // Add event listeners for all interactive elements
    const inputs = document.querySelectorAll('.input-form input, .input-form select');
    inputs.forEach(input => {
        input.addEventListener('input', updateGraph);
    });

    // Initial call to set up the graph with default values
    updateGraph();
</script>

</body>
</html>